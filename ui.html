<button id="add">+mark</button>
<ul id="figmark-list"></ul>
<script>

document.getElementById("add").onclick = () => {
  parent.postMessage({ pluginMessage: { type: "add-bookmark" } }, "*")
}

const findNode = (element) => {
  const id = element.dataset.id
  parent.postMessage({ pluginMessage: { type: "select-node", id: id } }, "*")
}

const jumpNode = (element) => {
  const id = element.dataset.id
  console.log(window)
  parent.postMessage({ pluginMessage: { type: "jump-node", id: id } }, "*")
  // TODO: ページ遷移、windowにアクセスできないので別の方法を検討する
}

onmessage = (event) => {
  const data = event.data.pluginMessage
  if(data.type === "update-figmark") {
    const listWrapper = document.getElementById("figmark-list")
    listWrapper.innerHTML = ""
    data.value.forEach(v => {
      // TODO: aタグでコンポーネントに遷移できるようにする
      // TODO: 削除ボタンを用意する
      // TODO: コンポーネント名を任意のものに変更できるようにする
      const li = document.createElement("li")
      li.dataset.id = v.id
      li.innerText = v.name

      const button = document.createElement("button")
      const selectButton = button.cloneNode(true)
      selectButton.innerText = "select"
      selectButton.onclick = (() => findNode(li))
      li.appendChild(selectButton)

      const jumpButton = button.cloneNode(true)
      jumpButton.innerText = "jump"
      jumpButton.onclick = (() => jumpNode(li))
      li.appendChild(jumpButton)

      listWrapper.appendChild(li)
    });
  }
}

</script>
